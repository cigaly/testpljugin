(function(a,c){var b=typeof document.createStyleSheet!="undefined";a.widget("custom.dijagram",{options:{engine:{size:10,rows:10,columns:10,mapping:function(f,d,e){if(f%2==0==d%2==0){return{active:false,black:false}}else{if(e){return{active:true,black:true,number:(this.rows-1-f)*(this.columns/2)+Math.floor((this.columns-1-d)/2)}}else{return{active:true,black:true,number:f*(this.columns/2)+Math.floor(d/2)}}}}},animationSpeed:700,fadeOutSpeed:300,bodyCountString:function(d){var e=d[3]?d[3]:"0";if(d[4]>0){e=e+"+"+d[4]}e=e+" - "+(d[1]?d[1]:"0");if(d[0]>0){e=e+"+"+d[0]}return e}},_create:function(){this._setOptions(this.options)},_refresh:function(){},_showBodyCount:function(d){this.bc.text(this.options.bodyCountString(d))},crtaj:function(){var n=function(B,z,u,w,y,v){var x=z[w],m=a('<td class="'+(y===true?"cp":"bp")+"_"+B.id+'">');if(!y&&x==0){x=3}var A=t.engine.encodeSquare(w);if(B.gifs[x+2]){m.append('<img src="'+B.gifs[x+2]+'" alt="'+B.alts[x+2]+'" title="'+A+'" />')}else{m.append('<div width="'+B.width+'" height="'+B.height+'" title="'+A+'" />')}if(!v[x+2]){v[x+2]=0}++v[x+2];m.attr("id","sq_"+u+"_"+(w+1));return m};var l=arguments[0].position,d=arguments[0].upsideDown,j=arguments[0].highlighted;var o=this.element;this.bc=arguments[0].bc||this.bc||a(".bodyCount");this.board_id=o[0].id?o[0].id:""+Math.random();var e=this.board_id;var t=this.options;var q=t.figure;var f=[];l=t.engine.unpackPosition(l);var s,h,i;var r=a("<table>").attr({cellspacing:0,cellpadding:0}).addClass("figure_"+q.id);for(s=0;s<t.engine.rows;++s){var p=a("<tr>");for(h=0;h<t.engine.columns;++h){var g=t.engine.mapping(s,h,d);if(g.active){p.append(n(q,l,e,g.number,g.black,f))}else{p.append('<td class="'+(g.black===true?"cp":"bp")+"_"+q.id+'"></td>')}}r.append(p)}o.html(r).addClass("pozicija");if(j&&q.transparent&&q.highlightedBlack){for(i=0;i<j.length;++i){a("#sq_"+e+"_"+(j[i]),o).attr("bgcolor",q.highlightedBlack)}}this._showBodyCount(f)},highlight:function(g,d){var e=function(h,i){a("#"+g+"_"+h).css("backgroundColor",i)};if(!this.options.figure.transparent||!this.options.figure.highlightedBlack){return}if(d instanceof Array){for(var f=0;f<d.length;++f){e(d[f],this.options.figure.highlightedBlack)}}else{e(d,this.options.figure.highlightedBlack)}},osvjezi:function(m){var j=m.position,d=m.upsideDown,e=this.board_id,n=this.options.engine;this.bc=m.bc||this.bc||a(".bodyCount");j=n.unpackPosition(j);var g=[];for(var o=0;o<n.rows;++o){for(var i=0;i<n.columns;++i){var h=n.mapping(o,i,d);if(!h.active){continue}var l=j[h.number];if(!h.black&&l==0){l=3}if(!g[l+2]){g[l+2]=0}++g[l+2];a("#sq_"+e+"_"+(h.number+1)+" img").attr({src:this.options.figure.gifs[l+2],alt:this.options.figure.alts[l+2]})}}this._showBodyCount(g)},_destroy:function(){console.log("Dijagram.destroy",this)},_setOptions:function(){a.Widget.prototype._setOptions.apply(this,arguments);this._refresh()},_setOption:function(e,f){var d=function(p,r){var j=["crnaDama","crnaFigura","praznoPolje","bijelaFigura","bijelaDama","bijeloPolje"];if(!r){return p.options.figure}if(!r.id){r.id=new Date().getTime()}r.alts=r.alts||["O ","o ",". ","x ","X ","  "];if(typeof r.directory==="undefined"){r.directory="./"}if(r.directory!==""&&r.directory.substring(r.directory.length-1)!="/"){r.directory+="/"}r.gifs=[];for(var i=0;i<j.length;++i){if(r[j[i]]){r.gifs[i]=r.directory+r[j[i]]}}var t;if(b){t=a("style[title=figure_"+r.id+"]")}else{t=a("style#figure_"+r.id)}if(!t.length){if(b){t=document.createStyleSheet();t.title="figure_"+r.id}else{t=a(document.createElement("style")).attr({id:"figure_"+r.id,type:"text/css"});t.appendTo(a("head"))}}var h=r.width?("width: "+r.width+"px;"):"";h+="line-height: 0.5; padding: 0;";if(r.height){h+="height: "+r.height+"px;"}var g=".bp_"+r.id+" {"+h;if(r.backgroundColorWhite){g+="background-color: "+r.backgroundColorWhite+";"}if(r.bijeloPolje){g+="background-image: url("+r.directory+r.bijeloPolje+");background-position: center center;background-repeat: no-repeat"}g+="}\n.cp_"+r.id+" {"+h;if(r.backgroundColorBlack){g+="background-color: "+r.backgroundColorBlack+";"}if(r.praznoPolje){g+="background-image: url("+r.directory+r.praznoPolje+");background-position: center center;background-repeat: no-repeat"}g+="}\n";if(b){t.cssText=g}else{try{t.empty().append(document.createTextNode(g))}catch(q){t[0].cssText=g}}if(p.options.engine.firstMoveWhite){return r}else{var l={};for(k in r){if(k!="gifs"&&k!="alts"){l[k]=r[k]}var o=r.gifs.slice(0);var m=o[0];o[0]=o[4];o[4]=m;m=o[1];o[1]=o[3];o[3]=m;l.gifs=o;var s=r.alts.slice(0);m=s[0];s[0]=s[4];s[4]=m;m=s[1];s[1]=s[3];s[3]=m;l.alts=s}return l}};if(e=="figure"){f=d(this,f)}else{if(e=="engine"&&a.isNumeric(f)){console.log("Engine: "+f);f=draughts_engine(f);console.log(f)}}a.Widget.prototype._setOption.call(this,e,f)},simpleMove:function(h,d,e){var f=this.element;var g=a(":animated");if(g&&g.length>0){g.stop();g=null}f.data("current").removeClass("potez2");f.data("current",h);h.addClass("potez2");this.osvjezi({position:h.attr("pozicija"),upsideDown:d});if(e){e()}},animateMove:function(j,d,h){console.log("Animate move",j,this);var n=this;var l=this.board_id;var r=this.options;var o=this.element;var i=function(t){var s=a("#sq_"+l+"_"+t+" img");if(s.length<1){s=a("#sq_"+l+"_"+t+" div")}return s};var f;f=function(x,v,z,y,u,t,w){var C=x.position(),D=v.shift(),B=i(D).position(),s,A;if(!t){t=C}x.css({position:"relative",top:C.top-t.top,left:C.left-t.left}).animate({top:B.top-t.top,left:B.left-t.left},r.animationSpeed,function(){n.highlight(l,u[u.length-1]);if(v.length>0){u.push(D);f(x,v,z,y,u,t,w)}else{if(y){s=typeof y=="string"?y.split(","):y;A=i(Number(s[0])+1);for(var E=0;E<s.length;++E){A.add(i(Number(s[E])+1))}A.fadeOut(r.fadeOutSpeed,function(){n.crtaj({position:z,upsideDown:d});n.highlight(l,u)})}else{n.crtaj({position:z,upsideDown:d});n.highlight(l,u)}if(w){w()}}})};var g=a(":animated");if(g&&g.length>0){g.stop();g=null;this.osvjezi({position:o.data("current").attr("pozicija"),upsideDown:d})}var p,e,m;o.data("current").removeClass("potez2");o.data("current",j);if("potez" in j[0]){p=j[0].potez.m}else{p=j.html()}j.addClass("potez2");while(p.match(/[x:]/)){p=p.replace(/[x:]/,"-")}e=p.split("-");for(var q=0;q<e.length;++q){e[q]=r.engine.decodeSquare(e[q])+1}m=e.shift();f(i(m),e,j.attr("pozicija"),j.attr("preko"),[m],null,h)}})})(jQuery);