var CrtacPozicije=(function(){function a(d,c,e,b){var g=this;this.gifs=[];this.msiestyle=typeof document.createStyleSheet!="undefined";if(!d.id){d.id=new Date().getTime()}this.engine=this.selectEngine(b);this.bodyCountString=e||(function(f){return g.displayBodyCount(f)});this.squares=this.engine.squares;this.rows=this.engine.rows;this.cols=this.engine.columns;this.figure(d)}a.prototype.selectEngine=function(b){if(typeof b=="undefined"){return draughts_engine(20)}else{if($.isNumeric(b)){return draughts_engine(b)}else{return b}}};a.prototype.displayBodyCount=function(b){var c=b[3]?b[3].toString():"0";if(b[4]>0){c=c+"+"+b[4]}c=c+" - "+(b[1]?b[1]:"0");if(b[0]>0){c=c+"+"+b[0]}return c};a.prototype.setupSquare=function(i,d,g,e,b,f){var j=b?(this.squares-1-g):g,h=i[j],c=$("<td class='cp_"+this._figure.id+"'>");if(h==0&&!e){h=3}if(this.gifs[h+2]){c.append("<img src='"+this.gifs[h+2]+"' alt='"+a.alts[h+2]+"' />")}else{c.append("<div width='"+this._figure.width+"' height='"+this._figure.height+"' />")}if(!f[h+2]){f[h+2]=0}++f[h+2];c.attr("id","sq_"+d+"_"+(g+1));return c};a.prototype.showBodyCount=function(b){this._bc.text(this.bodyCountString(b))};a.prototype.figure=function(e){if(!e){if(!this._figure.id){this._figure.id=new Date().getTime()}return this._figure}this._figure=e;if(this._figure.directory.substring(this._figure.directory.length-1)!="/"){this._figure.directory+="/"}this.gifs=[];for(var g=0;g<a.names.length;++g){if(this._figure[a.names[g]]){this.gifs[g]=this._figure.directory+this._figure[a.names[g]]}}if(!this.engine.firstMoveWhite){var c=this.gifs[0];this.gifs[0]=this.gifs[4];this.gifs[4]=c;c=this.gifs[1];this.gifs[1]=this.gifs[3];this.gifs[3]=c}var b;if(this.msiestyle){b=$("style[title=figure_"+this._figure.id+"]")}else{b=$("style#figure_"+this._figure.id)}if(b.length==0){var d=this.buildStyleString();if(this.msiestyle){this.createStyleSheetIE(d)}else{this.createStyleSheetNotIE(d)}}};a.prototype.buildStyleString=function(){var b="line-height: 0.5; padding: 0;";if(this._figure.width){b+="width: "+this._figure.width+"px;"}if(this._figure.height){b+="height: "+this._figure.height+"px;"}var c=".bp_"+this._figure.id+" {"+b;if(this._figure.backgroundColorWhite){c+="background-color: "+this._figure.backgroundColorWhite+";"}if(this._figure.bijeloPolje){c+="background-image: url("+this._figure.directory+this._figure.bijeloPolje+");background-position: center center;background-repeat: no-repeat"}c+="}\n.cp_"+this._figure.id+" {"+b;if(this._figure.backgroundColorBlack){c+="background-color: "+this._figure.backgroundColorBlack+";"}if(this._figure.praznoPolje){c+="background-image: url("+this._figure.directory+this._figure.praznoPolje+");background-position: center center;background-repeat: no-repeat"}return c+"}\n"};a.prototype.createStyleSheetNotIE=function(c){var b=$(document.createElement("style")).attr({type:"text/css",id:"figure_"+this._figure.id});try{b.append(document.createTextNode(c))}catch(d){b[0].cssText=c}b.appendTo("head")};a.prototype.createStyleSheetIE=function(c){var b=document.createStyleSheet();b.cssText=c;b.title="figure_"+this._figure.id};a.prototype.highlight=function(d,b){if(!this._figure.transparent){alert("Not transparent")}if(!this._figure.transparent||!this._figure.highlightedBlack){return}if(b instanceof Array){for(var c=0;c<b.length;++c){$("#"+d+"_"+b[c]).css("backgroundColor",this._figure.highlightedBlack)}}else{$("#"+d+"_"+b).css("backgroundColor",this._figure.highlightedBlack)}};a.prototype.crtaj=function(j,f,d,i,k){var l=$(f);if(l.length<1&&typeof(f)=="string"){l=$("#"+f)}this._bc=k||$(".bodyCount");this._board_id=l[0].id?l[0].id:""+Math.random();f=this._board_id;var g=[];j=this.engine.unpackPosition(j);var o=$("<table>").attr({cellspacing:0,cellpadding:0}).addClass("figure_"+this._figure.id);for(var b=0;b<this.rows;++b){var n=$("<tr>");for(var m=0;m<this.cols;++m){var e=this.engine.mapping(b,m,d);if(e.active){n.append(this.setupSquare(j,f,e.number,e.black,d,g))}else{if(e.black){n.append('<td class="cp_'+this._figure.id+'"></td>')}else{n.append('<td class="bp_'+this._figure.id+'"></td>')}}}o.append(n)}l.html(o).addClass("pozicija");if(i&&this._figure.transparent&&this._figure.highlightedBlack){for(var h=0;h<i.length;++h){$("#sq_"+f+"_"+(i[h]),l).attr("bgcolor",this._figure.highlightedBlack)}}this.showBodyCount(g)};a.prototype.osvjezi=function(d,g,j,h){if(!j){j=this._board_id}this._bc=h||$(".bodyCount");var c=this.engine.unpackPosition(d);var b=[];for(var i=0;i<this.squares;++i){var e=c[g?(this.squares-1-i):i];if(!b[e+2]){b[e+2]=0}++b[e+2];$("#sq_"+j+"_"+(i+1)+" img").attr({src:this.gifs[e+2],alt:a.alts[e+2]})}this.showBodyCount(b)};a.names=["crnaDama","crnaFigura","praznoPolje","bijelaFigura","bijelaDama","bijeloPolje"];a.alts=["O ","o ",". ","x ","X ","  "];return a}());